generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model auditoria {
  id               Int       @id @default(autoincrement())
  tabla            String    @db.VarChar(50)
  registro_id      Int
  accion           String    @db.VarChar(20)
  usuario_id       Int?
  datos_anteriores Json?
  datos_nuevos     Json?
  ip_address       String?   @db.VarChar(50)
  user_agent       String?
  fecha            DateTime? @default(now()) @db.Timestamptz(6)

  @@index([tabla, registro_id], map: "idx_auditoria_tabla_registro")
  @@index([usuario_id], map: "idx_auditoria_usuario")
}

model categorias {
  id          Int         @id @default(autoincrement())
  nombre      String      @unique @db.VarChar(100)
  descripcion String?
  icono       String?     @db.VarChar(50)
  color       String?     @db.VarChar(20)
  created_at  DateTime?   @default(now()) @db.Timestamp(6)
  productos   productos[]
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model clientes {
  id               Int       @id @default(autoincrement())
  tipo_cliente     String?   @default("ocasional") @db.VarChar(20)
  tipo_documento   String?   @db.VarChar(20)
  numero_documento String?   @db.VarChar(50)
  nombre           String    @db.VarChar(150)
  apellido         String?   @db.VarChar(150)
  email            String?   @db.VarChar(150)
  telefono         String?   @db.VarChar(20)
  direccion        String?
  ciudad           String?   @db.VarChar(100)
  es_institucional Boolean?  @default(false)
  dependencia      String?   @db.VarChar(200)
  total_compras    Decimal?  @default(0) @db.Decimal(10, 2)
  ultima_compra    DateTime? @db.Timestamp(6)
  activo           Boolean?  @default(true)
  created_at       DateTime? @default(now()) @db.Timestamp(6)
  updated_at       DateTime? @default(now()) @db.Timestamp(6)
  turnos           turnos[]
  ventas           ventas[]

  @@index([numero_documento], map: "idx_clientes_documento")
  @@index([email], map: "idx_clientes_email")
  @@index([tipo_cliente], map: "idx_clientes_tipo")
}

model configuracion {
  id          Int       @id @default(autoincrement())
  clave       String    @unique @db.VarChar(100)
  valor       String?
  tipo        String?   @db.VarChar(20)
  descripcion String?
  updated_at  DateTime? @default(now()) @db.Timestamp(6)
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model costos_produccion {
  id                  Int              @id @default(autoincrement())
  producto_id         Int?
  lote_id             Int?
  costo_materia_prima Decimal?         @default(0) @db.Decimal(10, 2)
  costo_mano_obra     Decimal?         @default(0) @db.Decimal(10, 2)
  costo_insumos       Decimal?         @default(0) @db.Decimal(10, 2)
  costo_energia       Decimal?         @default(0) @db.Decimal(10, 2)
  otros_costos        Decimal?         @default(0) @db.Decimal(10, 2)
  costo_total         Decimal?         @db.Decimal(10, 2)
  cantidad_producida  Decimal          @db.Decimal(10, 2)
  costo_unitario      Decimal?         @db.Decimal(10, 2)
  fecha_registro      DateTime?        @default(now()) @db.Date
  observaciones       String?
  created_at          DateTime?        @default(now()) @db.Timestamp(6)
  lote                lotes_productos? @relation(fields: [lote_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  producto            productos?       @relation(fields: [producto_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([producto_id], map: "idx_costos_producto")
  @@index([lote_id], map: "idx_costos_lote")
  @@index([fecha_registro], map: "idx_costos_fecha")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model descuentos {
  id                   Int                    @id @default(autoincrement())
  codigo               String                 @unique @db.VarChar(50)
  nombre               String                 @db.VarChar(100)
  descripcion          String?
  tipo                 String                 @db.VarChar(20)
  valor                Decimal                @db.Decimal(10, 2)
  minimo_compra        Decimal?               @db.Decimal(10, 2)
  maximo_descuento     Decimal?               @db.Decimal(10, 2)
  aplica_a             String?                @db.VarChar(20)
  categoria_id         Int?
  producto_id          Int?
  usos_maximos         Int?
  usos_actuales        Int?                   @default(0)
  fecha_inicio         DateTime?              @db.Date
  fecha_fin            DateTime?              @db.Date
  solo_aprendices      Boolean?               @default(false)
  solo_empleados       Boolean?               @default(false)
  solo_institucional   Boolean?               @default(false)
  activo               Boolean?               @default(true)
  created_at           DateTime?              @default(now()) @db.Timestamp(6)
  producto             productos?             @relation(fields: [producto_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  descuentos_aplicados descuentos_aplicados[]

  @@index([codigo], map: "idx_descuentos_codigo")
  @@index([activo], map: "idx_descuentos_activo")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model descuentos_aplicados {
  id               Int         @id @default(autoincrement())
  venta_id         Int?
  descuento_id     Int?
  monto_descuento  Decimal     @db.Decimal(10, 2)
  aplicado_por     Int?
  fecha_aplicacion DateTime?   @default(now()) @db.Timestamp(6)
  descuento        descuentos? @relation(fields: [descuento_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  venta            ventas?     @relation(fields: [venta_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([venta_id], map: "idx_descuentos_aplicados_venta")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model detalle_movimientos {
  id            Int                   @id @default(autoincrement())
  movimiento_id Int?
  producto_id   Int?
  lote_id       Int?
  cantidad      Decimal               @db.Decimal(10, 2)
  unidad        String?               @db.VarChar(20)
  lote          lotes_productos?      @relation(fields: [lote_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  movimiento    movimientos_unidades? @relation(fields: [movimiento_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  producto      productos?            @relation(fields: [producto_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model detalle_solicitudes {
  id                  Int                        @id @default(autoincrement())
  solicitud_id        Int?
  producto_id         Int?
  cantidad_solicitada Decimal                    @db.Decimal(10, 2)
  cantidad_aprobada   Decimal?                   @db.Decimal(10, 2)
  observaciones       String?
  producto            productos?                 @relation(fields: [producto_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  solicitud           solicitudes_transferencia? @relation(fields: [solicitud_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model detalle_ventas {
  id              Int              @id @default(autoincrement())
  venta_id        Int?
  producto_id     Int?
  lote_id         Int?
  cantidad        Decimal          @db.Decimal(10, 2)
  precio_unitario Decimal          @db.Decimal(10, 2)
  subtotal        Decimal          @db.Decimal(10, 2)
  lote            lotes_productos? @relation(fields: [lote_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  producto        productos?       @relation(fields: [producto_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  venta           ventas?          @relation(fields: [venta_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([venta_id], map: "idx_detalle_ventas_venta")
  @@index([producto_id, lote_id], map: "idx_detalle_ventas_producto_lote")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model historial_inventario {
  id                  Int        @id @default(autoincrement())
  producto_id         Int?
  tipo_movimiento     String     @db.VarChar(30)
  cantidad_anterior   Decimal?   @db.Decimal(10, 2)
  cantidad_movimiento Decimal    @db.Decimal(10, 2)
  cantidad_nueva      Decimal?   @db.Decimal(10, 2)
  usuario_id          Int?
  referencia_id       Int?
  referencia_tipo     String?    @db.VarChar(30)
  observaciones       String?
  fecha_movimiento    DateTime?  @default(now()) @db.Timestamptz(6)
  productos           productos? @relation(fields: [producto_id], references: [id], onUpdate: NoAction)

  @@index([fecha_movimiento], map: "idx_historial_fecha")
  @@index([producto_id], map: "idx_historial_producto")
  @@index([tipo_movimiento], map: "idx_historial_tipo")
  @@index([referencia_tipo, referencia_id], map: "idx_historial_referencia")
  @@index([usuario_id], map: "idx_historial_usuario")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model lotes_productos {
  id                   Int                   @id @default(autoincrement())
  producto_id          Int?
  codigo_lote          String                @unique @db.VarChar(50)
  cantidad             Decimal               @db.Decimal(10, 2)
  fecha_produccion     DateTime              @db.Timestamptz(6)
  fecha_vencimiento    DateTime?             @db.Timestamptz(6)
  unidad_productiva_id Int?
  estado               String?               @default("disponible") @db.VarChar(20)
  created_at           DateTime?             @default(now()) @db.Timestamp(6)
  usuario_id           Int?
  costos_produccion    costos_produccion[]
  detalle_movimientos  detalle_movimientos[]
  detalle_ventas       detalle_ventas[]
  usuario              usuarios?             @relation(fields: [usuario_id], references: [id], map: "fk_lotes_usuario")
  producto             productos?            @relation(fields: [producto_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  unidad_productiva    unidades_productivas? @relation(fields: [unidad_productiva_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([estado], map: "idx_lotes_estado")
  @@index([producto_id], map: "idx_lotes_producto")
  @@index([fecha_vencimiento], map: "idx_lotes_vencimiento")
  @@index([usuario_id], map: "idx_lotes_usuario")
}

model metodos_pago {
  id          Int           @id @default(autoincrement())
  nombre      String        @db.VarChar(50)
  descripcion String?
  activo      Boolean?      @default(true)
  icono       String?       @db.VarChar(50)
  created_at  DateTime?     @default(now()) @db.Timestamp(6)
  pagos_venta pagos_venta[]
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model movimientos_unidades {
  id                  Int                   @id @default(autoincrement())
  codigo_movimiento   String                @unique @db.VarChar(50)
  unidad_origen_id    Int?
  unidad_destino_id   Int?
  usuario_id          Int?
  fecha_movimiento    DateTime?             @default(now()) @db.Timestamptz(6)
  motivo              String?
  estado              String?               @default("completado") @db.VarChar(20)
  observaciones       String?
  created_at          DateTime?             @default(now()) @db.Timestamptz(6)
  detalle_movimientos detalle_movimientos[]
  unidad_destino      unidades_productivas? @relation("movimientos_destino", fields: [unidad_destino_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  unidad_origen       unidades_productivas? @relation("movimientos_origen", fields: [unidad_origen_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  usuario             usuarios?             @relation(fields: [usuario_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([unidad_destino_id], map: "idx_movimientos_destino")
  @@index([fecha_movimiento], map: "idx_movimientos_fecha")
  @@index([unidad_origen_id], map: "idx_movimientos_origen")
}

model notificaciones {
  id              Int       @id @default(autoincrement())
  tipo            String    @db.VarChar(30)
  titulo          String    @db.VarChar(200)
  mensaje         String
  prioridad       String?   @default("normal") @db.VarChar(20)
  leida           Boolean?  @default(false)
  usuario_id      Int?
  referencia_id   Int?
  referencia_tipo String?   @db.VarChar(30)
  created_at      DateTime? @default(now()) @db.Timestamp(6)

  @@index([created_at], map: "idx_notificaciones_fecha")
  @@index([leida], map: "idx_notificaciones_leida")
  @@index([usuario_id], map: "idx_notificaciones_usuario")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model pagos_venta {
  id             Int           @id @default(autoincrement())
  venta_id       Int?
  metodo_pago_id Int?
  monto          Decimal       @db.Decimal(10, 2)
  referencia     String?       @db.VarChar(100)
  fecha_pago     DateTime?     @default(now()) @db.Timestamptz(6)
  metodo_pago    metodos_pago? @relation(fields: [metodo_pago_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  venta          ventas?       @relation(fields: [venta_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([metodo_pago_id], map: "idx_pagos_metodo")
  @@index([venta_id], map: "idx_pagos_venta")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model cajas {
  id            Int             @id @default(autoincrement())
  codigo        String          @unique @db.VarChar(20)
  nombre        String          @db.VarChar(100)
  ubicacion     String?         @db.VarChar(200)
  tipo          String?         @default("principal") @db.VarChar(20)
  activa        Boolean?        @default(true)
  created_at    DateTime?       @default(now()) @db.Timestamp(6)
  updated_at    DateTime?       @default(now()) @db.Timestamp(6)
  sesiones_caja sesiones_caja[]
  turnos_caja   turnos_caja[]

  @@index([activa], map: "idx_cajas_activa")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model sesiones_caja {
  id                         Int                @id @default(autoincrement())
  codigo_sesion              String             @unique @db.VarChar(50)
  caja_id                    Int
  cajero_id                  Int
  fecha_apertura             DateTime           @default(now()) @db.Timestamp(6)
  fondo_inicial              Decimal            @default(0) @db.Decimal(10, 2)
  observaciones_apertura     String?
  fecha_cierre               DateTime?          @db.Timestamp(6)
  estado                     String?            @default("abierta") @db.VarChar(20)
  observaciones_cierre       String?
  total_ventas_efectivo      Decimal?           @default(0) @db.Decimal(10, 2)
  total_ventas_nequi         Decimal?           @default(0) @db.Decimal(10, 2)
  total_ventas_tarjeta       Decimal?           @default(0) @db.Decimal(10, 2)
  total_ventas_transferencia Decimal?           @default(0) @db.Decimal(10, 2)
  total_ingresos_adicionales Decimal?           @default(0) @db.Decimal(10, 2)
  total_retiros              Decimal?           @default(0) @db.Decimal(10, 2)
  total_gastos               Decimal?           @default(0) @db.Decimal(10, 2)
  efectivo_esperado          Decimal?           @db.Decimal(10, 2)
  efectivo_contado           Decimal?           @db.Decimal(10, 2)
  diferencia                 Decimal?           @db.Decimal(10, 2)
  desglose_efectivo          Json?
  cuadrada                   Boolean?           @default(false)
  created_at                 DateTime?          @default(now()) @db.Timestamp(6)
  arqueos_caja               arqueos_caja[]
  gastos_caja                gastos_caja[]
  movimientos_caja           movimientos_caja[]
  retiros_caja               retiros_caja[]
  turnos_caja                turnos_caja[]
  caja                       cajas              @relation(fields: [caja_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  cajero                     usuarios           @relation(fields: [cajero_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([caja_id], map: "idx_sesiones_caja")
  @@index([cajero_id], map: "idx_sesiones_cajero")
  @@index([fecha_apertura], map: "idx_sesiones_fecha")
  @@index([estado], map: "idx_sesiones_estado")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model movimientos_caja {
  id                    Int           @id @default(autoincrement())
  sesion_caja_id        Int
  venta_id              Int?
  tipo_movimiento       String        @db.VarChar(20)
  metodo_pago           String?       @db.VarChar(20)
  monto                 Decimal       @db.Decimal(10, 2)
  descripcion           String?
  usuario_id            Int?
  requiere_autorizacion Boolean?      @default(false)
  autorizado_por        Int?
  fecha_movimiento      DateTime?     @default(now()) @db.Timestamp(6)
  autorizador           usuarios?     @relation("movimientos_caja_autorizador", fields: [autorizado_por], references: [id], onDelete: NoAction, onUpdate: NoAction)
  sesion_caja           sesiones_caja @relation(fields: [sesion_caja_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  usuario               usuarios?     @relation("movimientos_caja_usuario", fields: [usuario_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  venta                 ventas?       @relation(fields: [venta_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([sesion_caja_id], map: "idx_movimientos_caja_sesion")
  @@index([tipo_movimiento], map: "idx_movimientos_caja_tipo")
  @@index([fecha_movimiento], map: "idx_movimientos_caja_fecha")
  @@index([venta_id], map: "idx_movimientos_caja_venta")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model retiros_caja {
  id              Int           @id @default(autoincrement())
  sesion_caja_id  Int
  monto           Decimal       @db.Decimal(10, 2)
  motivo          String        @db.VarChar(200)
  solicitado_por  Int
  autorizado_por  Int?
  estado          String?       @default("pendiente") @db.VarChar(20)
  fecha_solicitud DateTime?     @default(now()) @db.Timestamp(6)
  fecha_respuesta DateTime?     @db.Timestamp(6)
  observaciones   String?
  recibo_url      String?       @db.VarChar(500)
  destino_fondos  String?       @db.VarChar(200)
  autorizador     usuarios?     @relation("retiros_caja_autorizador", fields: [autorizado_por], references: [id], onDelete: NoAction, onUpdate: NoAction)
  sesion_caja     sesiones_caja @relation(fields: [sesion_caja_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  solicitante     usuarios      @relation("retiros_caja_solicitante", fields: [solicitado_por], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([sesion_caja_id], map: "idx_retiros_sesion")
  @@index([estado], map: "idx_retiros_estado")
  @@index([fecha_solicitud], map: "idx_retiros_fecha")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model gastos_caja {
  id              Int           @id @default(autoincrement())
  sesion_caja_id  Int
  monto           Decimal       @db.Decimal(10, 2)
  categoria_gasto String        @db.VarChar(100)
  descripcion     String
  beneficiario    String?       @db.VarChar(200)
  comprobante_url String?       @db.VarChar(500)
  numero_factura  String?       @db.VarChar(100)
  autorizado_por  Int?
  fecha_gasto     DateTime?     @default(now()) @db.Timestamp(6)
  observaciones   String?
  autorizador     usuarios?     @relation(fields: [autorizado_por], references: [id], onDelete: NoAction, onUpdate: NoAction)
  sesion_caja     sesiones_caja @relation(fields: [sesion_caja_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([sesion_caja_id], map: "idx_gastos_sesion")
  @@index([categoria_gasto], map: "idx_gastos_categoria")
  @@index([fecha_gasto], map: "idx_gastos_fecha")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model arqueos_caja {
  id              Int           @id @default(autoincrement())
  sesion_caja_id  Int
  tipo_arqueo     String        @db.VarChar(20)
  realizado_por   Int
  fecha_arqueo    DateTime?     @default(now()) @db.Timestamp(6)
  billetes_100000 Int?          @default(0)
  billetes_50000  Int?          @default(0)
  billetes_20000  Int?          @default(0)
  billetes_10000  Int?          @default(0)
  billetes_5000   Int?          @default(0)
  billetes_2000   Int?          @default(0)
  billetes_1000   Int?          @default(0)
  monedas_1000    Int?          @default(0)
  monedas_500     Int?          @default(0)
  monedas_200     Int?          @default(0)
  monedas_100     Int?          @default(0)
  monedas_50      Int?          @default(0)
  total_contado   Decimal?      @db.Decimal(10, 2)
  total_esperado  Decimal?      @db.Decimal(10, 2)
  diferencia      Decimal?      @db.Decimal(10, 2)
  observaciones   String?
  realizador      usuarios      @relation(fields: [realizado_por], references: [id], onDelete: NoAction, onUpdate: NoAction)
  sesion_caja     sesiones_caja @relation(fields: [sesion_caja_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([sesion_caja_id], map: "idx_arqueos_sesion")
  @@index([tipo_arqueo], map: "idx_arqueos_tipo")
  @@index([fecha_arqueo], map: "idx_arqueos_fecha")
}

/// Modelo para gesti√≥n de turnos de caja
model turnos_caja {
  id              Int           @id @default(autoincrement())
  sesion_caja_id  Int
  cajero_id       Int
  caja_id         Int
  tipo_relevo     String        @db.VarChar(30)
  fecha_inicio    DateTime      @default(now()) @db.Timestamp(6)
  fecha_fin       DateTime?     @db.Timestamp(6)
  monto_inicial   Decimal       @db.Decimal(10, 2)
  monto_final     Decimal?      @db.Decimal(10, 2)
  diferencia      Decimal?      @db.Decimal(10, 2)
  duracion_minutos Int?
  estado          String        @default("activo") @db.VarChar(20)
  motivo_suspension String?
  observaciones   String?
  created_at      DateTime?     @default(now()) @db.Timestamp(6)
  sesion_caja     sesiones_caja @relation(fields: [sesion_caja_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  cajero          usuarios      @relation("turnos_cajero", fields: [cajero_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  caja            cajas         @relation(fields: [caja_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([sesion_caja_id], map: "idx_turnos_caja_sesion")
  @@index([cajero_id], map: "idx_turnos_caja_cajero")
  @@index([caja_id], map: "idx_turnos_caja_id")
  @@index([estado], map: "idx_turnos_caja_estado")
  @@index([fecha_inicio], map: "idx_turnos_caja_fecha")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains an expression index which requires additional setup for migrations. Visit https://pris.ly/d/expression-indexes for more info.
model productos {
  id                   Int                    @id @default(autoincrement())
  codigo               String                 @unique @db.VarChar(50)
  nombre               String                 @db.VarChar(150)
  descripcion          String?
  categoria_id         Int?
  unidad_productiva_id Int?
  tipo_medida          String                 @db.VarChar(20)
  unidad               String?                @db.VarChar(20)
  precio_unitario      Decimal                @db.Decimal(10, 2)
  precio_mayorista     Decimal?               @db.Decimal(10, 2)
  stock_actual         Decimal?               @default(0) @db.Decimal(10, 2)
  stock_minimo         Decimal?               @default(0) @db.Decimal(10, 2)
  stock_maximo         Decimal?               @db.Decimal(10, 2)
  es_perecedero        Boolean?               @default(false)
  dias_vencimiento     Int?
  imagen_url           String?                @db.VarChar(500)
  activo               Boolean?               @default(true)
  created_at           DateTime?              @default(now()) @db.Timestamp(6)
  updated_at           DateTime?              @default(now()) @db.Timestamp(6)
  proveedor_id         Int?
  es_produccion_propia Boolean?               @default(true)
  costos_produccion    costos_produccion[]
  descuentos           descuentos[]
  detalle_movimientos  detalle_movimientos[]
  detalle_solicitudes  detalle_solicitudes[]
  detalle_ventas       detalle_ventas[]
  historial_inventario historial_inventario[]
  lotes_productos      lotes_productos[]
  categoria            categorias?            @relation(fields: [categoria_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  proveedor            proveedores?           @relation(fields: [proveedor_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  unidad_productiva    unidades_productivas?  @relation(fields: [unidad_productiva_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([activo], map: "idx_productos_activo")
  @@index([categoria_id], map: "idx_productos_categoria")
  @@index([codigo], map: "idx_productos_codigo")
  @@index([unidad_productiva_id], map: "idx_productos_unidad")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model proveedores {
  id                Int         @id @default(autoincrement())
  codigo            String      @unique @db.VarChar(50)
  nombre            String      @db.VarChar(200)
  nit               String?     @db.VarChar(50)
  contacto_nombre   String?     @db.VarChar(150)
  contacto_email    String?     @db.VarChar(150)
  contacto_telefono String?     @db.VarChar(20)
  direccion         String?
  ciudad            String?     @db.VarChar(100)
  tipo_productos    String[]
  activo            Boolean?    @default(true)
  created_at        DateTime?   @default(now()) @db.Timestamp(6)
  updated_at        DateTime?   @default(now()) @db.Timestamp(6)
  productos         productos[]

  @@index([codigo], map: "idx_proveedores_codigo")
  @@index([activo], map: "idx_proveedores_activo")
}

model roles {
  id          Int        @id @default(autoincrement())
  nombre      String     @unique @db.VarChar(50)
  descripcion String?
  permisos    Json?      @default("{}")
  created_at  DateTime?  @default(now()) @db.Timestamp(6)
  updated_at  DateTime?  @default(now()) @db.Timestamp(6)
  usuarios    usuarios[]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model solicitudes_transferencia {
  id                     Int                   @id @default(autoincrement())
  codigo_solicitud       String                @unique @db.VarChar(50)
  unidad_solicitante_id  Int?
  unidad_proveedora_id   Int?
  usuario_solicitante_id Int?
  estado                 String?               @default("pendiente") @db.VarChar(20)
  fecha_solicitud        DateTime?             @default(now()) @db.Timestamp(6)
  fecha_respuesta        DateTime?             @db.Timestamp(6)
  usuario_respuesta_id   Int?
  observaciones          String?
  motivo_rechazo         String?
  detalle_solicitudes    detalle_solicitudes[]
  unidad_proveedora      unidades_productivas? @relation("solicitudes_proveedora", fields: [unidad_proveedora_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  unidad_solicitante     unidades_productivas? @relation("solicitudes_solicitante", fields: [unidad_solicitante_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  usuario_respuesta      usuarios?             @relation("solicitudes_respuesta", fields: [usuario_respuesta_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  usuario_solicitante    usuarios?             @relation("solicitudes_solicitante", fields: [usuario_solicitante_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([estado], map: "idx_solicitudes_estado")
  @@index([unidad_solicitante_id], map: "idx_solicitudes_solicitante")
  @@index([unidad_proveedora_id], map: "idx_solicitudes_proveedora")
  @@index([fecha_solicitud], map: "idx_solicitudes_fecha")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model turnos {
  id                Int       @id @default(autoincrement())
  numero_turno      Int
  cliente_nombre    String?   @db.VarChar(150)
  cliente_id        Int?
  estado            String?   @default("esperando") @db.VarChar(20)
  cajero_id         Int?
  fecha             DateTime? @default(dbgenerated("CURRENT_DATE")) @db.Date
  hora_creacion     DateTime? @default(now()) @db.Timestamptz(6)
  hora_atencion     DateTime? @db.Timestamptz(6)
  hora_finalizacion DateTime? @db.Timestamptz(6)
  cliente           clientes? @relation(fields: [cliente_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@unique([numero_turno, fecha])
  @@index([fecha], map: "idx_turnos_fecha")
  @@index([estado], map: "idx_turnos_estado")
  @@index([cajero_id], map: "idx_turnos_cajero")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model unidades_productivas {
  id                      Int                         @id @default(autoincrement())
  codigo                  String                      @unique @db.VarChar(20)
  nombre                  String                      @db.VarChar(100)
  descripcion             String?
  tipo                    String?                     @db.VarChar(50)
  responsable_id          Int?
  ubicacion               String?                     @db.VarChar(200)
  activa                  Boolean?                    @default(true)
  created_at              DateTime?                   @default(now()) @db.Timestamp(6)
  updated_at              DateTime?                   @default(now()) @db.Timestamp(6)
  lotes_productos         lotes_productos[]
  movimientos_destino     movimientos_unidades[]      @relation("movimientos_destino")
  movimientos_origen      movimientos_unidades[]      @relation("movimientos_origen")
  productos               productos[]
  solicitudes_proveedora  solicitudes_transferencia[] @relation("solicitudes_proveedora")
  solicitudes_solicitante solicitudes_transferencia[] @relation("solicitudes_solicitante")
  responsable             usuarios?                   @relation(fields: [responsable_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model usuarios {
  id                                    Int                         @id @default(autoincrement())
  nombre                                String                      @db.VarChar(100)
  apellido                              String                      @db.VarChar(100)
  email                                 String                      @unique @db.VarChar(150)
  password_hash                         String                      @db.VarChar(255)
  rol_id                                Int?
  activo                                Boolean?                    @default(true)
  ultimo_acceso                         DateTime?                   @db.Timestamp(6)
  created_at                            DateTime?                   @default(now()) @db.Timestamp(6)
  updated_at                            DateTime?                   @default(now()) @db.Timestamp(6)
  arqueos_caja                          arqueos_caja[]
  gastos_caja                           gastos_caja[]
  lotes_productos                       lotes_productos[]
  movimientos_caja_autorizador          movimientos_caja[]          @relation("movimientos_caja_autorizador")
  movimientos_caja_usuario              movimientos_caja[]          @relation("movimientos_caja_usuario")
  movimientos_unidades                  movimientos_unidades[]
  retiros_caja_autorizador              retiros_caja[]              @relation("retiros_caja_autorizador")
  retiros_caja_solicitante              retiros_caja[]              @relation("retiros_caja_solicitante")
  sesiones_caja                         sesiones_caja[]
  solicitudes_transferencia_respuesta   solicitudes_transferencia[] @relation("solicitudes_respuesta")
  solicitudes_transferencia_solicitante solicitudes_transferencia[] @relation("solicitudes_solicitante")
  turnos_caja                           turnos_caja[]               @relation("turnos_cajero")
  unidades_productivas                  unidades_productivas[]
  rol                                   roles?                      @relation(fields: [rol_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  ventas                                ventas[]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model ventas {
  id                   Int                    @id @default(autoincrement())
  codigo_venta         String                 @unique @db.VarChar(50)
  usuario_id           Int?
  fecha_venta          DateTime?              @default(now()) @db.Timestamptz(6)
  subtotal             Decimal                @db.Decimal(10, 2)
  impuesto             Decimal?               @default(0) @db.Decimal(10, 2)
  descuento            Decimal?               @default(0) @db.Decimal(10, 2)
  total                Decimal                @db.Decimal(10, 2)
  cliente_nombre       String?                @db.VarChar(150)
  cliente_email        String?                @db.VarChar(150)
  cliente_telefono     String?                @db.VarChar(20)
  estado               String?                @default("completada") @db.VarChar(20)
  requiere_factura     Boolean?               @default(false)
  factura_generada     Boolean?               @default(false)
  factura_url          String?                @db.VarChar(500)
  observaciones        String?
  created_at           DateTime?              @default(now()) @db.Timestamptz(6)
  cliente_id           Int?
  deleted_at           DateTime?              @db.Timestamptz(6)
  descuentos_aplicados descuentos_aplicados[]
  detalle_ventas       detalle_ventas[]
  movimientos_caja     movimientos_caja[]
  pagos_venta          pagos_venta[]
  cliente              clientes?              @relation(fields: [cliente_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  usuario              usuarios?              @relation(fields: [usuario_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([estado], map: "idx_ventas_estado")
  @@index([fecha_venta], map: "idx_ventas_fecha")
  @@index([usuario_id], map: "idx_ventas_usuario")
  @@index([fecha_venta, usuario_id], map: "idx_ventas_fecha_usuario")
  @@index([cliente_id], map: "idx_ventas_cliente")
}
